태그: #정보처리기사 
연결문서: [SQL 5](SQL%205.md)

# 01. SQL 명령어

## 06. 트랜잭션 제어어(TCL)

### 1) 트랜잭션(Transaction)
1. 트랜잭션의 개념
    - 데이터베이스의 현재 상태를 하나의 일관된 상태에서 또 다른 일관된 상태로 변환시키는 논리적인 연산의 집합
    - 트랜잭션을 일 처리 단위를 의미함
2. 트랜잭션의 특징
    - 트랜잭션은 논리적 연산 단위
    - 한 개 이상의 데이터베이스 조작
    - 하나 이상의 SQL 문장이 포함됨
    - SELECT, INSERT, UPDATE, DELETE 등의 연산 집합
    - 트랜잭션은 거래로, 거래 결과가 모두 변영되거나 또는 모두 취소되어야 함
    - 데이터베이스에서의 트랜잭션은 특별하고 엄격한 거래를 의미함
    - 분할할 수 없는 최소 단위
    - 트랜잭션은 일반적으로 회복의 단위가 됨

<br>

### 2) 트랜잭션의 특성
1. 원자성(Atomicity)
    - 트랜잭션의 연산은 모두 실행되거나 모두 실행되지 않아야 함
    - 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 함
    - 트랜잭션은 일부만 수행된 상태로 종료되어서는 안 됨
    - 트랜잭션 A가 수행되는 동안 다른 트랜잭션 B는 트랜잭션 A가 지금까지 수행한 중간 결과를 참조할 수 없음
2. 일관성(Consistency, 무결성)
    - 트랜잭션 실행 전과 후 동일하게 오류가 없어야 함
    - 트랜잭션을 완전히 실행하면 데이터베이스를 하나의 일관된 상태에서 다른 일관된 상태로 바꿔야 함
    - 시스템이 가지고 있는 고정 요소는 트랜잭션 수행 전과 수행 완료 후가 같아야 함
3. 고립성(Isolation, 독립성, 격리성)
    - 트랜잭션 실행 중 다른 트랜잭션에 영향을 받지 않아야 함
    - 하나의 트랜잭션의 실행은 동시에 실행 중인 다른 트랜잭션의 간섭을 받아서는 안 됨
    - 트랜잭션이 수행 중에 다른 트랜잭션 연산에 끼어들 수 없음
4. 지속성(Durability, 계속성, 영속성, 장애 대응성)
    - 트랜잭션 결과는 항상 보존되어야 함
    - 트랜잭션에 의해서 변화된 상태는 계속해서 유지될 수 있어야 함
    - 완료한 트랜잭션에 의해 데이터베이스에 가해진 변경은 어떠한 고장에도 손실되지 않아야 함
    - 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장 나더라도 영구적으로 반영되어야 함

<br>

### 3) 트랜잭션 상태 제어
- 트랜잭션 상태를 제어한다는 것은 흐름의 구조를 바꾼다는 것이 아니라 트랜잭션의 결과를 수용하거나 취소하는 것을 의미함
<br>

1. 활동(Active)
    - 트랜잭션이 실행 중인 상태
    - 초기 상태로 트랜잭션이 실행을 시작하였거나 실행 중인 상태
2. 부분 완료(Partially Committed)
    - 트랜잭션이 마지막 연산을 끝내고 데이터베이스에 실행 결과를 적용하기 직전의 상태
3. 완료(Committed)
    - 트랜잭션이 연산을 완료하고 연산의 결과를 데이터베이스에 적용한 상태
    - 트랜잭션이 성공적으로 완료 연산을 수행한 상태
4. 실패(Failed)
    - 트랜잭션이 실행 중 어떤 오류에 의해서 더 이상 진행될 수 없는 상태
5. 철회(Aborted)
    - 트랜잭션 실행이 실패하여 복귀되어 있는 상태
    - 트랜잭션이 실행에 실패하여 ROLLBACK 연산을 수행한 상태
    - ROLLBACK은 거래 내역을 취소함
    - CHECKPOINT는 ROLLBACK할 위치를 지정하여 저장지점을 설정함
6. Redo(다시 실행)
    - 갱신이 완료된 데이터를 로그 파일을 이용하여 복원함
    - 이미 진행 중이었던 작업을 다시 함
7. Undo(실행 취소 = ROLLBACK)
    - 변경되었던 데이터를 취소하여 원래의 내용으로 복원함
    - 처음에 있던 옛 데이터를 이용하여 데이터를 복원함
    - 했던 작업을 다시 하지 않고 원상태로 되돌림

<br>

### 4) TCL의 명령어

#### 1. COMMIT 명령어 특징
- 변경 사항이 물리적인 디스크에 저장됨
- COMMIT 명령 이후에는 COMMIT 이전 상태로 복구할 수 없음
- 모든 사용자가 변경된 결과를 볼 수 있음
- COMMIT 이후 변경된 튜플(행)은 LOCK이 해제됨

#### 2. ROLLBACK 명령어 특징
- 데이터베이스의 연산에 문제가 발생하면 이미 수행되었던 모든 작업을 취소하고 원래 상태로 복귀함
- ROLLBACK 명령 이후 메모리상의 버퍼에만 영향을 미치기 때문에 복구가 가능함
- 해당 튜플(행)은 LOCK이 해제됨

#### 3. SAVEPOINT 명령어 특징
- 데이터베이스를 이용하는 응용 프로그램에서 명령어들의 규모가 크거나 복잡할 경우에 주로 사용하는 언어
- 명령어들을 사용하는 중간에 오류가 발생하면 처음부터 다시 실행하는 것보다는 중간 특정 시점부터 다시 실행하는 것이 효과적일 수 있다는 것
- 특정 중간 시점을 SAVEPOINT로 지정하고, SAVEPOINT 이후에 오류가 발생하면, 처음부터 다시 시작하는 것이 아니라 SAVEPOINT부터 실행할 수 있음
- SAVEPOINT는 여러 개를 두어 사용할 수 있음
- 트랜잭션의 처리 결과는 주 메모리에 남지만, 데이터베이스는 보조 기억 장치에 있기 때문에 트랜잭션의 처리 결과를 주 메모리에 남겨 놓았다가 너무 많으면 트랜잭션이 끝나지 않은 상태에서도 보조 기억 장치에 있는 데이터베이스에 저장하게 되는 것

<br>

### 5) CRUD 분석
1. CRUD
    - C(Create), R(Read), U(Update), D(Delete)를 표현한 약어
2. CRUD Matrix
    - 프로세스와 데이터의 상관관계를 현실적으로 표현한 테이블
    - 프로세스가 개체에 주는 영향을 표현한 것
    
| &nbsp;&nbsp;CRUD&nbsp;&nbsp;| &nbsp;&nbsp;고객&nbsp;&nbsp; | &nbsp;&nbsp;제품&nbsp;&nbsp; | &nbsp;&nbsp;재고&nbsp;&nbsp; | &nbsp;&nbsp;공금&nbsp;&nbsp; |
|:-:|:-:|:-:|:-:|:-:|
| &nbsp;&nbsp;고객등록&nbsp;&nbsp; | &nbsp;&nbsp;C&nbsp;&nbsp; ||||
| &nbsp;&nbsp;판매주문&nbsp;&nbsp; | &nbsp;&nbsp;R&nbsp;&nbsp; | &nbsp;&nbsp;R&nbsp;&nbsp; | &nbsp;&nbsp;U&nbsp;&nbsp; | &nbsp;&nbsp;U&nbsp;&nbsp; |
| &nbsp;&nbsp;재고조사&nbsp;&nbsp; || &nbsp;&nbsp;R&nbsp;&nbsp; | &nbsp;&nbsp;R&nbsp;&nbsp; | &nbsp;&nbsp;R&nbsp;&nbsp; |

3. CRUD 분석
    - 데이터베이스에 영향을 주는 생성, 읽기, 갱신, 삭제 연산으로 프로세스와 테이블 간에 CRUD 매트릭스를 만들어서 트랜잭션을 분석하는 것