íƒœê·¸: #Reference

# ì‹¤ë¬´ì½”ë“œ(ì½”í‹€ë¦° - ê±´ìš°ë‹˜ ì œê³µ)

## ğŸ’¡ Separate API

<br>

í˜„ì¬ ì‚¬ìš©ë˜ê³  ìˆëŠ” ë³´ë“œ APIë¥¼ ë¶„ë¦¬í•  ì˜ˆì •

1. íˆ¬ë°ì´í« ê²Œì‹œê¸€ (ì¼ìƒ)
2. ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€
3. í•¨ê»˜í•´ìš” ê²Œì‹œê¸€

- ê°ê°ì˜ ê²Œì‹œê¸€ì— í•„ìš”í•œ ê°’ë§Œ ì „ë‹¬í•  ì˜ˆì •
- íˆ¬ë°ì´í« ê²Œì‹œê¸€
  í•„ìš” API (Post, Patch, Get)
  \- Post (ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸, Content (String) ì „ë‹¬)
  \- Patch (ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸, Content (String) ì „ë‹¬) 
      ì˜ˆì „ ê²Œì‹œê¸€ ë‚´ìš© (detail ë³€ìˆ˜) log.infoë¡œ ì¶œë ¥
  \- Get (ê¸°ì¡´ ì •ë³´ë¡œ ì¼ë‹¨ êµ¬í˜„ - ì§ì ‘ ìˆ˜ì • ì˜ˆì •)

---

## ğŸ’¡ Alert

Entity

```kotlin
    fun modifyingAlertBoard(data: AlertDTO) {
        /** @desc ì‹¤ì¢… ì •ë³´ */
        this.requestedAt = data.missingDate
        this.requestedAt02 = data.missingTime
        this.requestedLocation = data.missingLocation
        this.phoneNumber = data.userPhone ?: ""

        /** ë°˜ë ¤ë™ë¬¼ ì •ë³´ */
        this.animalName = data.user.animalName
        this.requestAnimalUser = data.missingAnimalKind
        this.breed = data.missingAnimalBreed
        this.requestGender = data.user.animalGender ?: ""
        this.animalNetralization = data.user.animalNeutralization
        this.animalSize = data.user.animalSize
        this.animalBirth = data.missingAnimalBirth

        /** @desc ê¸€ ì •ë³´ */
        this.requestContent = data.detail.content ?: ""
        this.pics = data.detail.images
    }
```

<br>

DTO

```kotlin
package com.cosmic.dangnyang.network.dto.v3.board

import com.cosmic.dangnyang.entity.Board
import java.time.LocalDateTime

/* ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ DTO */

/** @desc Post DTO */
data class AlertDTO (

    var user: CommunityDTO.User,
    var detail: CommunityDTO.CommunityDetail,
    var userPhone: String? = "",

    /** @desc ì‹¤ì¢… ì •ë³´ */
    var missingDate: LocalDateTime? = null,
    var missingTime: LocalDateTime? = null,
    var missingLocation: String = "",

    /** @desc ë°˜ë ¤ë™ë¬¼ ì •ë³´ */
    var missingAnimalKind: String = "",
    var missingAnimalBreed: String = "",
    var missingAnimalBirth: String = "",
)

/** Detail DTO */
class AlertDetail(
    var user: CommunityDTO.User,
    var kind : String,
    var detail : CommunityDTO.CommunityDetail,

    /** @desc ì‹¤ì¢… ì •ë³´ */
    var missingDate: LocalDateTime? = null,
    var missingTime: LocalDateTime? = null,
    var missingLocation: String = "",
    var userPhone: String? = "",

    /** @desc ë°˜ë ¤ë™ë¬¼ ì •ë³´ */
    var missingAnimalKind: String = "",
    var missingAnimalBreed: String = "",
    var missingAnimalBirth: String = "",
) {
    companion object {
        fun fromEntity(board: Board, uid : String) : AlertDetail {
            return AlertDetail(
                kind = "ì‹¤ì¢…ì‹ ê³ ",
                user = CommunityDTO.User.fromEntity(board.user),
                detail = CommunityDTO.CommunityDetail.fromEntity(board, uid),
                missingDate = board.requestedAt,
                missingTime = board.requestedAt02,
                missingLocation = board.requestedLocation ?: "",
                userPhone = board.phoneNumber,
                missingAnimalKind = board.requestAnimalUser,
                missingAnimalBreed = board.breed ?: "",
                missingAnimalBirth = board.animalBirth ?: ""
            )
        }
    }
}

/** Response DTO */
data class AlertResponseDTO (
    var id: Long? = null
) {
    object ModelMapper {
        fun entityToDto(form: Board): AlertResponseDTO {
            return AlertResponseDTO(
                id = form.id
            )
        }
    }
}
```

<br>Service

```kotlin
/* ì‹¤ì¢…ì‹ ê³  ê²Œì‹œíŒ ì„œë¹„ìŠ¤ */

@Service
class AlertService (
    @Autowired private val userRecycleFn: UserRecycleFn,
    @Autowired private val boardRecycleFn: BoardRecycleFn,
    @Autowired private val ncpS3UploaderRecycleFn: NcpS3UploaderRecycleFn,
    @Autowired private val apiService: ApiService,
    @Autowired private val boardRepository: BoardRepository
        ) {

    /**
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ì—…ë¡œë“œ
     */
    @Transactional
    fun postAlertBoard(
        uid: String,
        data: AlertDTO,
        multipartFile: List<MultipartFile>
    ): AlertResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)
        userRecycleFn.validateUser(anUser, "alert")

        val aBoard: Board = try {
            Board(user = anUser).apply {
                kind = "ì‹¤ì¢…ì‹ ê³ "
                requestContent = data.detail.content ?: ""
                pics = data.detail.images
                requestedAt = data.missingDate
                requestedAt02 = data.missingTime
                requestedLocation = data.missingLocation
                phoneNumber = data.userPhone ?: ""
                animalName = data.user.animalName
                requestAnimalUser = data.missingAnimalKind
                breed = data.missingAnimalBreed
                requestGender = data.user.animalGender ?: ""
                animalNetralization = data.user.animalNeutralization
                animalSize = data.user.animalSize
                animalBirth = data.missingAnimalBirth
                createdAt = LocalDateTime.now()
            }
        } catch (e: Exception) {
            log.error("ALERT-004 : ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìƒì„± ì—ëŸ¬ - $e, $uid")
            throw CommonException("ALERT-004", HttpStatus.BAD_REQUEST)
        }

        if (aBoard.kind != "ì‹¤ì¢…ì‹ ê³ ") {
            apiService.serverErrorWebHook(
                "ì‹¤ì¢…ì‹ ê³  ê¸€ì´ ì•„ë‹™ë‹ˆë‹¤.",
            CommonException("ALERT-004", HttpStatus.BAD_REQUEST))
        }

        ncpS3UploaderRecycleFn.upload(aBoard, multipartFile, uid, "ì‹¤ì¢…ì‹ ê³ ", "alert")

        log.info("ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $aBoard.id ]")

        return AlertResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìˆ˜ì •
     */
    @Transactional
    fun patchAlertBoard (
        boardId: String,
        uid: String,
        data: AlertDTO,
        multipartFile: List<MultipartFile>
    ): AlertResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "ì‹¤ì¢…ì‹ ê³ ") {
            apiService.serverErrorWebHook(
                "ì‹¤ì¢…ì‹ ê³  ê¸€ì´ ì•„ë‹™ë‹ˆë‹¤.",
                CommonException("ALERT-004", HttpStatus.BAD_REQUEST))
        }

        ncpS3UploaderRecycleFn.update(aBoard, multipartFile, uid, "ì‹¤ì¢…ì‹ ê³ ", "alert")

        log.info("ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìˆ˜ì • ì „ ê²Œì‹œê¸€ - [ {${aBoard.requestContent} ]")

        aBoard.modifyingAlertBoard(data)

        log.info("ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìˆ˜ì • ì™„ë£Œ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ]")

        return AlertResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ì¡°íšŒ
     */
    fun getAlertBoard (
        boardId: String,
        uid: String
    ): AlertDetail {

        val anUser = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "ì‹¤ì¢…ì‹ ê³ ") {
            apiService.serverErrorWebHook(
                "[ ë³´ì•ˆ ì•Œë¦¼ ] ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ì´ ì•„ë‹™ë‹ˆë‹¤ - ${aBoard.kind}",
                CommonException("ALERT-004", HttpStatus.BAD_REQUEST))
        }

        val result = try {
            boardRepository.findByIdAndCheckStatus(boardId.toLong(), false)
        } catch (e: Exception) {
            log.error("ALERT-002 : ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ]")
            throw CommonException("ALERT-002", HttpStatus.BAD_REQUEST)
        }

        log.info("ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ì¡°íšŒ ì„±ê³µ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ]")

        return AlertDetail.fromEntity(aBoard, uid)
    }

    companion object {
        private val log: Logger = LogManager.getLogger(this.javaClass.name)
    }
}
```

<br>

Controller

```kotlin
/* ì‹¤ì¢…ì‹ ê³  ê²Œì‹œíŒ ì»¨íŠ¸ë¡¤ëŸ¬ */

@RestController
@RequestMapping("/alert")
class AlertController (
    @Autowired private val alertService: AlertService
        ) {

    /**
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param uid : ì‘ì„±ì
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìƒì„± API
     */
    @Auth(Auth.Role.USER)
    @PostMapping
    fun postAlertBoard(
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: AlertDTO,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<AlertResponseDTO> {
        return ResponseEntity(alertService.postAlertBoard(uid, data, multipartFile), HttpStatus.CREATED)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ìˆ˜ì •í•  ê²Œì‹œê¸€ ì •ë³´
     * @param uid : ì‘ì„±ì
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ìˆ˜ì • API
     */
    @Auth(Auth.Role.USER)
    @PatchMapping("/{boardId}")
    fun patchAlertBoard(
        @PathVariable boardId: String,
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: AlertDTO,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<AlertResponseDTO> {
        return ResponseEntity(alertService.patchAlertBoard(boardId, uid, data, multipartFile), HttpStatus.OK)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid: ì‘ì„±ì
     * @desc ì‹¤ì¢…ì‹ ê³  ê²Œì‹œê¸€ ë‹¨ê±´ ì¡°íšŒ API
     */
    @Auth(Auth.Role.USER)
    @GetMapping("/{boardId}")
    fun getAlertBoard(
        @PathVariable boardId: String,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<AlertDetail> {
        return ResponseEntity(alertService.getAlertBoard(uid, boardId), HttpStatus.OK)
    }
}
```

---

ê³µí†µ ê²€ì¦ ë¡œì§

Getì€ 2ë²ˆì¨° if ë¬¸ ì „ì²´ë¥¼ ëº´ì•¼í•˜ê³ 

Patch APIëŠ” ì´ ì½”ë“œë¥¼ ì „ì²´ ë‹¤ì¨ì•¼í•¨ 

```kotlin
    /* ìœ ì € & ë³´ë“œ ê²€ì¦ */
    fun validateUserAndBoard(user: User, board: Board) {

        if (user.grade != "ì •íšŒì›") {
            throw CommonException("${board.kind}-005 - íšŒì› ë“±ê¸‰ ì˜¤ë¥˜", HttpStatus.FORBIDDEN)
        }

        // Patch API ì—ì„œ ì”€
        if (board.kind != "${board.kind}") {
            log.error("${board.kind}-004 : ${board.kind} ê²Œì‹œê¸€ì´ ì•„ë‹™ë‹ˆë‹¤ - ${board.kind}")
            throw CommonException("${board.kind}-004", HttpStatus.BAD_REQUEST)
        } else if (user.id != board.user.id) {
            log.error("${board.kind}-004 : ì‘ì„±ìê°€ ì•„ë‹™ë‹ˆë‹¤")
            throw CommonException("${board.kind}-011", HttpStatus.BAD_REQUEST)
        }
    }
```

<br>

CommunityDTO

```kotlin
class CommunityDTO {

    data class User (
            var uid : String?,

            var userName : String?,
            var userAgeRange : String?,
            var userGender : String?,

            var animalName : String?,
            var animal : String?,
            var animalProfile : String?,
            var animalGender : String?,
            var animalNeutralization : Boolean?,
            var animalSize : String?,

            var give : Int?,
            var take : Int?,

            var location : LocationResDTO?,
            var trustPoint : Int?
            ) {

        companion object {
            fun fromEntity(user : com.cosmic.dangnyang.entity.User) : User {
                return User(
                        uid = user.id,
                        userName = user.name,
                        userGender = user.gender,
                        userAgeRange = user.ageRange,

                        animalName = user.animals[0].name,
                        animal = user.animals[0].animal,
                        animalProfile = user.animals[0].profile,
                        animalGender = user.animals[0].gender,
                        animalNeutralization = user.animals[0].neutralization,
                        animalSize = user.animals[0].size,

                        give = user.give,
                        take = user.take,

                        location = user.geometry?.let { LocationResDTO.ModelMapper.entityToDto(it) },
                        trustPoint = user.trustPoint
                )
            }
        }
    }

    data class CommunityDetail (
        var user : User? = null,
        var modified : Boolean? = null,
        var content : String? = null,
        var images : List<String>? = null,
        var liked : Boolean? = null,
        var pushNotification : Boolean? = null,
        var comment : List<CommentDTO> = listOf(),
        var createdAt : LocalDateTime? = null,
    ) {
        companion object {
            fun fromEntity(board : Board, uid : String) : CommunityDetail {
                return CommunityDetail.run {
                    CommunityDetail(
                        user = User.fromEntity(board.user),
                        modified = (board.modifiedAt != null),
                        content = board.requestContent,
                        images = board.pics,
                        liked = board.boardAlreadyLike(uid),
                        pushNotification = board.pushUsers.contains(uid),
                        comment = board.comments.filter { it.activateComment() }.map { CommentDTO.ModelMapper.entityToDto(it) }.toList(),
                        createdAt = board.createdAt,
                    )
                }
            }
        }
    }

    class LifeDetail(
            var kind : String,
            var detail : CommunityDetail
    ) {
        companion object {
            fun fromEntity(board : Board, uid : String) : LifeDetail {
                return LifeDetail(
                        kind = "ì¼ìƒ",
                        detail = CommunityDetail.fromEntity(board, uid)
                )
            }
        }
    }
}
```

<br>

### Entity

```kotlin
    fun modifyingTodayPetBoard(data: TodayPetDTO) {
        this.requestContent = data.detail.content ?: ""
        this.pics = data.detail.images
        this.modifiedAt = LocalDateTime.now()
    }

    fun modifyingTogetherBoard(data: TogetherDTO) {
        this.requestContent = data.detail.content ?: ""
        this.pics = data.detail.images
        this.modifiedAt = LocalDateTime.now()
    }

    fun modifyingAlertBoard(data: AlertDTO) {
        /** @desc ì‹¤ì¢… ì •ë³´ */
        this.requestedAt = data.missingDate
        this.requestedAt02 = data.missingTime
        this.requestedLocation = data.missingLocation
        this.phoneNumber = data.userPhone ?: ""

        /** ë°˜ë ¤ë™ë¬¼ ì •ë³´ */
        this.animalName = data.user.animalName
        this.requestAnimalUser = data.missingAnimalKind
        this.breed = data.missingAnimalBreed
        this.requestGender = data.user.animalGender ?: ""
        this.animalNetralization = data.user.animalNeutralization
        this.animalSize = data.user.animalSize
        this.animalBirth = data.missingAnimalBirth

        /** @desc ê¸€ ì •ë³´ */
        this.requestContent = data.detail.content ?: ""
        this.pics = data.detail.images
        this.modifiedAt = LocalDateTime.now()
    }
```

<br>

### ImageRecycleFn

```kotlin
/** @desc ì´ë¯¸ì§€ Recycle Function */

@Component
class NcpS3UploaderRecycleFn (
    @Autowired private val ncpS3Uploader: NcpS3Uploader,
    @Autowired private val apiService: ApiService
        ) {

    /**
     * @param aBoard : ê²Œì‹œê¸€
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param boardKind : Web Hook ì „ì†¡ì„ ìœ„í•œ ê²Œì‹œíŒì˜ **í•œê¸€ëª…**
     * @desc ê²Œì‹œê¸€ì˜ ì…ë ¥ë°›ì€ ì´ë¯¸ì§€ ì‚­ì œ ê²€ì¦ ë¡œì§
     */
    fun validateImages (
        aBoard: Board,
        multipartFile: List<MultipartFile>,
        boardKind: String
    ) {
        if (multipartFile.isNotEmpty()) {
            try {
                ncpS3Uploader.removeImages(aBoard.pics ?: listOf())
                aBoard.removePics()
            } catch (e: Exception) {
                apiService.serverErrorWebHook("$boardKind ê²Œì‹œíŒ ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨", e)
            }
        }
    }

    /**
     * @param aBoard : ê²Œì‹œê¸€
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param boardKind : Web Hook ì „ì†¡ì„ ìœ„í•œ ê²Œì‹œíŒì˜ **í•œê¸€ëª…**
     * @param boardCategory : ë¡œê·¸ ê¸°ë¡ì„ ìœ„í•¨, Error ì½”ë“œì— ì“°ì¼ ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ì˜ **ì˜ë¬¸ëª…**
     * @desc ì´ë¯¸ì§€ ì‚­ì œ ì™„ë£Œ í›„, ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
     */
    fun updateImages (
        aBoard: Board,
        multipartFile: List<MultipartFile>,
        boardKind: String,
        boardCategory: String
    ) {

        if (multipartFile.isNotEmpty()) {
            try {
                ncpS3Uploader.removeImages(aBoard.pics ?: listOf())
                aBoard.removePics()
            } catch (e: Exception) {
                apiService.serverErrorWebHook("$boardKind ê²Œì‹œíŒ ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨", e)
            }


            val newImages = try {
                ncpS3Uploader.uploadImages(multipartFile, "$boardCategory/${aBoard.id}")
            } catch (e: CommonException) {
                aBoard.removePics()
                val error: String = boardCategory.toUpperCase()
                log.error("$error-IMG-002 : $boardKind ê²Œì‹œíŒ ì´ë¯¸ì§€ ìˆ˜ì • ì‹¤íŒ¨", e)
                throw CommonException("$error-IMG-002", HttpStatus.BAD_REQUEST)
            }
            aBoard.updatePics(newImages)
        }
    }

    companion object {
        private val log: Logger = LogManager.getLogger(this.javaClass.name)
    }
}
```

---

## ğŸ’¡ Today Pet

<br>

### Controller

```kotlin
/* Today Pet Controller */

@RestController
@RequestMapping("/today")
class TodayPetController (
    @Autowired private val todayPetService: TodayPetService
        ) {

    /**
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param uid : ì‘ì„±ì
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìƒì„± API
     */
    @Auth(Auth.Role.USER)
    @PostMapping
    fun postTodayPetBoard(
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: TodayPetDTO,
        @RequestAttribute("uid") uid: String,
    ) : ResponseEntity<TodayPetResponseDTO> {
        return ResponseEntity(todayPetService.postTodayPetBoard(uid, data, multipartFile), HttpStatus.CREATED)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ìˆ˜ì •í•  ê²Œì‹œê¸€ ì •ë³´
     * @param uid : ì‘ì„±ì
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìˆ˜ì • API
     */
    @Auth(Auth.Role.USER)
    @PatchMapping("/{boardId}")
    fun patchTodayPetBoard(
        @PathVariable boardId: String,
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: TodayPetDTO,
        @RequestAttribute("uid") uid: String,
    ) : ResponseEntity<TodayPetResponseDTO> {
        return ResponseEntity(todayPetService.patchTodayPetBoard(boardId ,uid, data, multipartFile), HttpStatus.OK)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ë‹¨ê±´ ì¡°íšŒ API
     */
    @Auth(Auth.Role.USER)
    @GetMapping("/{boardId}")
    fun getTodayPetBoard(
        @PathVariable boardId: String,
        @RequestAttribute("uid") uid: String
    ) : ResponseEntity<TodayPetDetail> {
        return ResponseEntity(todayPetService.getTodayPetBoard(uid, boardId), HttpStatus.OK)
    }
}
```

<br>

### DTO

```kotlin
/* íˆ¬ë°ì´í« ê²Œì‹œíŒ DTO */

/** @desc Post DTO */
data class TodayPetDTO (
    var user: CommunityDTO.User,
    var detail: CommunityDTO.CommunityDetail
)

/** @desc Detail DTO */
data class TodayPetDetail (
    var kind: String,
    var user: CommunityDTO.User,
    var detail: CommunityDTO.CommunityDetail
) {
    companion object {
        fun fromEntity(board: Board, uid: String) : TodayPetDetail {
            return TodayPetDetail(
                kind = "ì¼ìƒ",
                user = CommunityDTO.User.fromEntity(board.user),
                detail = CommunityDTO.CommunityDetail.fromEntity(board, uid)
            )
        }
    }
}

/** @desc Response DTO */
data class TodayPetResponseDTO (
    var id: Long? = null
) {
    object ModelMapper {
        fun entityToDto(form: Board): TodayPetResponseDTO {
            return TodayPetResponseDTO(
                id = form.id
            )
        }
    }
}
```

<br>

### Service

ì¶”í›„ ê²€ì¦ë¡œì§ì„ ë¹¼ì„œ RecycleFn ìœ¼ë¡œ ë§Œë“¤ ì˜ˆì •

```kotlin
/* íˆ¬ë°ì´í« ê²Œì‹œíŒ ì„œë¹„ìŠ¤ */

@Service
class TodayPetService(
    @Autowired private val userRecycleFn: UserRecycleFn,
    @Autowired private val apiService: ApiService,
    @Autowired private val boardRecycleFn: BoardRecycleFn,
    @Autowired private val ncpS3UploaderRecycleFn: NcpS3UploaderRecycleFn
) {

    /**
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìƒì„±
     */
    @Transactional
    fun postTodayPetBoard(
        uid: String,
        data: TodayPetDTO,
        multipartFile: List<MultipartFile>
    ): TodayPetResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)

        userRecycleFn.validateUser(anUser, "today")

        val aBoard: Board = try {
            Board(user = anUser).apply {
                kind = "ì¼ìƒ"
                requestContent = data.detail.content ?: ""
                pics = data.detail.images
                createdAt = LocalDateTime.now()
            }
        } catch (e: Exception) {
            log.error("TODAY-004 : íˆ¬ë°ì´ ê²Œì‹œê¸€ ìƒì„± ì—ëŸ¬ - $e, $uid")
            throw CommonException("TODAY-004", HttpStatus.BAD_REQUEST)
        }

        ncpS3UploaderRecycleFn.upload(aBoard, multipartFile, uid,"íˆ¬ë°ì´í«", "today")

        log.info("íˆ¬ë°ì´ ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $aBoard.id ]")

        return TodayPetResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìˆ˜ì •
     */
    @Transactional
    fun patchTodayPetBoard(
        boardId: String,
        uid: String,
        data: TodayPetDTO,
        multipartFile: List<MultipartFile>
    ): TodayPetResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "íˆ¬ë°ì´í«") {
            apiService.serverErrorWebHook(
                "[ ë³´ì•ˆ ì•Œë¦¼ ] íˆ¬ë°ì´í« ê²Œì‹œê¸€ì´ ì•„ë‹™ë‹ˆë‹¤ - ${aBoard.kind}",
                CommonException("TODAY-004", HttpStatus.BAD_REQUEST)
            )
        }

        ncpS3UploaderRecycleFn.update(aBoard, multipartFile, uid,"íˆ¬ë°ì´í«", "today")

        log.info("íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìˆ˜ì • ì „ ê²Œì‹œê¸€ - [ ${aBoard.requestContent} ]")

        aBoard.modifyingTodayPetBoard(data)

        log.info("íˆ¬ë°ì´í« ê²Œì‹œê¸€ ìˆ˜ì • ì™„ë£Œ - [ ì‘ì„±ì : $uid, ê¸€ë²ˆí˜¸ : $boardId")

        return TodayPetResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param boardId : ê¸€ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     * @desc íˆ¬ë°ì´í« ê²Œì‹œê¸€ ì¡°íšŒ
     */
    fun getTodayPetBoard(
        boardId: String,
        uid: String
    ): TodayPetDetail {

        val anUser = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "ì¼ìƒ") {
            apiService.serverErrorWebHook(
                " [ ë³´ì•ˆ ì•Œë¦¼ ] íˆ¬ë°ì´í« ê²Œì‹œê¸€ì´ ì•„ë‹™ë‹ˆë‹¤ - ${aBoard.kind}",
                CommonException("TODAY-004", HttpStatus.BAD_REQUEST)
            )
        }

        val result = try {
            TodayPetDetail.fromEntity(aBoard, uid)
        } catch (e: Exception) {
            log.error("TODAY-002 : íˆ¬ë°ì´í« ê²Œì‹œê¸€ ë°ì´í„° ë§¤í•‘ ì‹¤íŒ¨ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId")
        }

        log.info("íˆ¬ë°ì´í« ê²Œì‹œê¸€ ì¡°íšŒ ì„±ê³µ - [ ì‘ì„±ì : $uid, ê¸€ë²ˆí˜¸ : $boardId ]")

        return result as TodayPetDetail
    }

    companion object {
        private val log: Logger = LogManager.getLogger(this.javaClass.name)
    }

```

<br>

### Entity

```kotlin
    fun modifyingTodayPetBoard(data : TodayPetDTO) {
        this.requestContent = data.content
    }
```

---

## ğŸ’¡ Together

### DTO

```kotlin
/* í•¨ê»˜í•´ìš” ê²Œì‹œíŒ DTO */

/** @desc Post DTO */
data class TogetherDTO (
    var user: CommunityDTO.User,
    var detail: CommunityDTO.CommunityDetail,
)

/** @desc Detail DTO */
class TogetherDetail(
    var kind: String,
    var user: CommunityDTO.User,
    var detail: CommunityDTO.CommunityDetail
) {
    companion object {
        fun fromEntity(board: Board, uid: String) : TogetherDetail {
            return TogetherDetail(
                kind = "í•¨ê»˜í•´ìš”",
                detail = CommunityDTO.CommunityDetail.fromEntity(board, uid),
                user = CommunityDTO.User.fromEntity(board.user)
            )
        }
    }
}

/** Response DTO */
data class TogetherResponseDTO (
    var id: Long? = null
) {
    object ModelMapper {
        fun entityToDto(form: Board): TogetherResponseDTO {
            return TogetherResponseDTO(
                id = form.id
            )
        }
    }
}
```

<br>

### Controller

```kotlin
package com.cosmic.dangnyang.Controller.v4

import com.cosmic.dangnyang.Service.v3.board.TogetherService
import com.cosmic.dangnyang.config.interceptor.Auth
import com.cosmic.dangnyang.network.dto.v3.board.TogetherDTO
import com.cosmic.dangnyang.network.dto.v3.board.TogetherDetail
import com.cosmic.dangnyang.network.dto.v3.board.TogetherResponseDTO
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.http.HttpStatus
import org.springframework.http.ResponseEntity
import org.springframework.web.bind.annotation.*
import org.springframework.web.multipart.MultipartFile

/* í•¨ê»˜í•´ìš” ê²Œì‹œíŒ ì»¨íŠ¸ë¡¤ëŸ¬ */

@RestController
@RequestMapping("/together")
class TogetherController (
    @Autowired private val togetherService: TogetherService
        ) {

    /**
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @desc í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìƒì„± API
     */
    @Auth(Auth.Role.USER)
    @PostMapping
    fun postTogetherBoard(
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: TogetherDTO,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<TogetherResponseDTO> {
        return ResponseEntity(togetherService.postTogetherBoard(uid, data, multipartFile), HttpStatus.CREATED)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @param data : ìˆ˜ì •í•  ê²Œì‹œê¸€ ì •ë³´
     * @param uid : ì‘ì„±ì
     * @desc í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìˆ˜ì • API
     */
    @Auth(Auth.Role.USER)
    @PatchMapping("/{boardId}")
    fun patchTogetherBoard(
        @PathVariable boardId: String,
        @RequestPart multipartFile: List<MultipartFile>,
        @RequestPart data: TogetherDTO,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<TogetherResponseDTO> {
        return ResponseEntity(togetherService.patchTogetherBoard(boardId, uid, data, multipartFile), HttpStatus.OK)
    }

    @Auth(Auth.Role.USER)
    @GetMapping("/{boardId}")
    fun getTogetherBoard(
        @PathVariable boardId: String,
        @RequestAttribute("uid") uid: String
    ): ResponseEntity<TogetherDetail> {
        return ResponseEntity(togetherService.getTogetherBoard(uid, boardId), HttpStatus.OK)
    }
}
```

<br>

### Service

```kotlin
/* í•¨ê»˜í•´ìš” ê²Œì‹œíŒ ì„œë¹„ìŠ¤ */

@Service
class TogetherService (
    @Autowired private val userRecycleFn: UserRecycleFn,
    @Autowired private val boardRecycleFn: BoardRecycleFn,
    @Autowired private val ncpS3UploaderRecycleFn: NcpS3UploaderRecycleFn,
    @Autowired private val apiService: ApiService,
    @Autowired private val boardRepository: BoardRepository
        ) {

    /**
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @param multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ì—…ë¡œë“œ
     */
    @Transactional
    fun postTogetherBoard(
        uid: String,
        data: TogetherDTO,
        multipartFile: List<MultipartFile>
    ): TogetherResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)

        userRecycleFn.validateUser(anUser, "together")

        val aBoard: Board = try {
            Board(user = anUser).apply {
                kind = "í•¨ê»˜í•´ìš”"
                requestContent = data.detail.content ?: ""
                pics = data.detail.images
                createdAt = LocalDateTime.now()
            }
        } catch (e: Exception) {
            log.error("TOGETHER-004 : í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìƒì„± ì—ëŸ¬ - $e, $uid")
            throw CommonException("TOGETHER-004", HttpStatus.BAD_REQUEST)
        }

        if (aBoard.kind != "í•¨ê»˜í•´ìš”") {
            apiService.serverErrorWebHook(
                "í•¨ê»˜í•´ìš” ê¸€ì´ ì•„ë‹™ë‹ˆë‹¤.",
                CommonException("TOGETHER-004", HttpStatus.BAD_REQUEST)
            )
        }

        ncpS3UploaderRecycleFn.upload(aBoard, multipartFile, uid, "í•¨ê»˜í•´ìš”", "together")

        log.info("í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $aBoard.id ]")

        return TogetherResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     * @param data : ê²Œì‹œê¸€ ì •ë³´
     * @pram multipartFile : ì´ë¯¸ì§€ íŒŒì¼
     * @desc í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìˆ˜ì •
     */
    @Transactional
    fun patchTogetherBoard(
        boardId: String,
        uid: String,
        data: TogetherDTO,
        multipartFile: List<MultipartFile>
    ): TogetherResponseDTO {

        val anUser = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "í•¨ê»˜í•´ìš”") {
            apiService.serverErrorWebHook(
                "í•¨ê»˜í•´ìš” ê¸€ì´ ì•„ë‹™ë‹ˆë‹¤.",
                CommonException("TOGETHER-004", HttpStatus.BAD_REQUEST)
            )
        }

        ncpS3UploaderRecycleFn.update(aBoard, multipartFile, uid,"í•¨ê»˜í•´ìš”", "together")

        log.info("í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìˆ˜ì • ì „ ê²Œì‹œê¸€ - [ {${aBoard.requestContent}} ]")

        aBoard.modifyingTogetherBoard(data)

        log.info("í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ìˆ˜ì • ì™„ë£Œ = [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ]")

        return TogetherResponseDTO.ModelMapper.entityToDto(aBoard)
    }

    /**
     * @param boardId : ê¸€ ë²ˆí˜¸
     * @param uid : ì‘ì„±ì
     */
    fun getTogetherBoard(
        boardId: String,
        uid: String
    ): TogetherDetail {

        val anUser  = userRecycleFn.checkActiveUser(uid)
        val aBoard = boardRecycleFn.checkBoardStatus(boardId.toLong(), uid, false)

        boardRecycleFn.validateUserAndBoard(anUser, aBoard)

        if (aBoard.kind != "í•¨ê»˜í•´ìš”") {
            apiService.serverErrorWebHook(
                "[ ë³´ì•ˆ ì•Œë¦¼ ] í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ì´ ì•„ë‹™ë‹ˆë‹¤ - ${aBoard.kind}",
                CommonException("TOGETHER-004", HttpStatus.BAD_REQUEST)
            )
        }

        val result = try {
            boardRepository.findByIdAndCheckStatus(boardId.toLong(), false)
        } catch (e: Exception) {
            log.error("TOGETHER-002 : í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ]")
            throw CommonException("TOGETHER-002", HttpStatus.BAD_REQUEST)
        }

        log.info("í•¨ê»˜í•´ìš” ê²Œì‹œê¸€ ì¡°íšŒ ì„±ê³µ - [ ì‘ì„±ì : $uid, ê¸€ ë²ˆí˜¸ : $boardId ] ")

        return TogetherDetail.fromEntity(aBoard, uid)

    }

    companion object {
        private val log: Logger = LogManager.getLogger(this.javaClass.name)
    }
```

